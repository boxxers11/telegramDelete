# מעקב פיצ'רים - Telegram Delete Application

## פיצ'רים מיושמים

### 1. מערכת חשבונות
- **תיאור**: ניהול חשבונות טלגרם מרובים
- **פיצ'רים**:
  - הוספת חשבונות חדשים עם API ID ו-API Hash
  - אימות חשבונות
  - שמירת נתוני חשבונות ב-`accounts.json`
  - תצוגת סטטוס חשבון (מחובר/לא מחובר)

### 2. סריקת קבוצות ויזואלית (Diamond Interface)
- **תיאור**: ממשק יהלומים לסריקה ויזואלית של קבוצות
- **פיצ'רים**:
  - מפת יהלומים המציגה 142 קבוצות
  - צבעי יהלומים: לבן (לא נסרק), צהוב (בסריקה), ירוק (הושלם), סגול (עם הודעות), אדום (שגיאה)
  - סריקה קבוצה אחר קבוצה עם `batch_size: 1`
  - שמירת מצב סריקה ב-`localStorage`
  - כפתור איפוס סריקה
  - סטטיסטיקות בזמן אמת
  - ממשק מודאלי עם גלילה פנימית עצמאית שאינה משפיעה על דף הרקע
  - לוג עדכונים בזמן אמת לאירועי סריקה

### 3. ניהול הודעות
- **תיאור**: הצגה ומחיקה של הודעות שנמצאו בקבוצות
- **פיצ'רים**:
  - רשימת הודעות עם תוכן, תאריך ובחירה
  - כפתור "בחר הכל" להודעות
  - מחיקת הודעות נבחרות
  - אנימציית מחיקה (wipe out)
  - עדכון סטטיסטיקות לאחר מחיקה

### 4. שליחת הודעות Batch (Wizard)
- **תיאור**: מערכת wizard בשלבים לשליחת הודעות לקבוצות
- **פיצ'רים**:
  - **שלב 1 - הודעה**:
    - כתיבת הודעה
    - היסטוריית הודעות (10 האחרונות)
    - עריכת הודעות מההיסטוריה
    - מחיקת הודעות מההיסטוריה
  - **שלב 2 - קבוצות**:
    - בחירת קבוצות עם checkbox
    - כפתור "בחר הכל" / "בטל הכל"
    - שמירת הקבצות (presets) של קבוצות
    - טעינת הקבצות שמורות
    - מחיקת הקבצות
  - **שלב 3 - סיכום**:
    - תצוגת הודעה
    - רשימת קבוצות נבחרות
    - זמן שליחה אחרונה (אדום אם פחות משעה)
    - הגדרות עיכוב ומצב בדיקה
    - שליחה אמיתית או בדיקה

### 5. ממשק משתמש מתקדם
- **תיאור**: עיצוב גלאס מורפיזם עם RTL
- **פיצ'רים**:
  - עיצוב זכוכית מתקדם (glass morphism)
  - תמיכה מלאה ב-RTL (עברית)
  - אנימציות וטרנזישנים
  - מודלים צפים עם אפקט זכוכית
  - כפתורים עם focus states
  - טיפוגרפיה מותאמת לעברית
  - תמיכה בהתנהגות גלילה תקינה גם בתוך מודלים עמוקים

### 6. ניהול מצב ונתונים
- **תיאור**: שמירה וטעינה של מצב האפליקציה
- **פיצ'רים**:
  - שמירת מצב סריקה ב-`localStorage`
  - שמירת היסטוריית הודעות
  - שמירת הקבצות של קבוצות
  - טעינת מצב לאחר רענון דף
  - איפוס מצב סריקה

### 7. API Backend
- **תיאור**: שרת FastAPI עם Telethon
- **פיצ'רים**:
  - CORS מוגדר לתמיכה ב-localhost
  - ניהול חשבונות (`/accounts`)
  - סריקת קבוצות (`/accounts/{id}/scan`)
  - סטטוס סריקה (`/accounts/{id}/scan-status`)
  - מחיקת הודעות (`/accounts/{id}/delete-messages`)
  - שליחת הודעות batch (`/accounts/{id}/send-batch-message`)
  - איפוס סריקה (`/accounts/{id}/reset`)

### 8. ניהול שגיאות ותגובות
- **תיאור**: טיפול בשגיאות והודעות למשתמש
- **פיצ'רים**:
  - הודעות הצלחה ושגיאה
  - הודעות אוטו-היעלמות
  - טיפול בשגיאות API
  - לוגים מפורטים בטרמינל
  - בדיקות תקינות נתונים
  - לוג פעילות בזמן אמת במודאל בדיקת משתמש (כולל פירוט שאילתא ותגובות פר-חשבון)

### 9. שליחה למתייגים
- **תיאור**: טאב חדש ב-Message Wizard המאגד אזכורים של המשתמש ומאפשר תגובה מהירה.
- **פיצ'רים**:
  - בחירת טווח ימים (1-14) לטעינת תיוגים אחרונים.
  - טבלה מפורטת המציגה קבוצה, משתמש, תאריך/שעה, תוכן ההודעה המקורית וההודעה האחרונה שנשלחה על-ידנו.
  - חלון מענה עם תצוגת כדור של הודעת הלקוח והתגובה האחרונה שלנו, כולל קישור לפרופיל הטלגרם שלו.
  - תיבת תגובה עם פס התקדמות, צליל הצלחה וסגירה אוטומטית לאחר שליחה מוצלחת.
  - עדכון סטטוס ברשימת התיוגים שמסמן אלו תיוגים טופלו.

### 10. סריקת הודעות אחרונות
- **תיאור**: חלון ייעודי להצגת הודעות פרטיות אחרונות שהתקבלו לחשבון.
- **פיצ'רים**:
  - פתיחת החלון מתוך מסכי הסריקה (פשוט ויהלום) במקום כפתור שליחת ההודעות הישן.
  - בחירה דינמית של מספר ההודעות לטעינה (1-50) בלחיצת כפתור.
  - טבלה מרוכזת המציגה שולח, שם משתמש, טקסט ההודעה ותאריך קבלה.
  - שימוש חוזר במנגנון נעילת הגלילה כך שהרקע הראשי אינו זז בזמן הצגת החלון.

### 11. מודלים רחבים וחוויית גלילה מתוקנת
- **תיאור**: עדכוני עיצוב ואקססיביליות למודלים המרכזיים.
- **פיצ'רים**:
  - כל מודלי הסריקה, החיפוש הסמנטי והשליחה הורחבו ל-90% רוחב המסך, עם פינות מעוגלות ויחסי גובה קבועים.
  - נעילת גלילה ייעודית (body + html) בעת פתיחת מודלים כדי למנוע גלילת רקע.
  - Message Wizard Modal מעודכן עם גובה קבוע (`90vh`) ותמיכה במעבר בין טאבים מורחבים.

### 12. חיפוש סמנטי – בחירת קבוצות משופרת
- **תיאור**: Selector חדש לניהול קבוצות הסריקה.
- **פיצ'רים**:
  - כפתור "קבוצות לסריקה" פותח בחירה ייעודית עם SharedGroupsList כולל חיפוש וסינון.
  - אפשרות לבחור/לבטל בחירה של כל הקבוצות ולצפות ברשימת הקבוצות שנבחרו.
  - שמירת הבחירה כחלק מבקשת החיפוש וניטור מספר הקבוצות בתצוגת הלחצן.

### 13. שדרוג מנגנון התור וה-Backend
- **תיאור**: שיפורים בלוגיקת התור לצמצום התנגשויות בין פעולות.
- **פיצ'רים**:
  - פעולות שליחת הודעות (קבוצות, פרטי, תגובה לתיוג) וסריקת הודעות אחרונות עוצרות את סריקת הקבוצות, שומרות את המצב ומחדשות לאחר השלמה.
  - הוספת API חדש לשליפת תיוגים (`/accounts/{id}/mentions`) ולשליחת תגובה ממוקדת (`/accounts/{id}/mentions/reply`).
  - הרחבת `/accounts/{id}/scan-status` להצגת רשימת הקבוצות שנסרקו בזמן אמת במקום להמתין לתום התהליך.

### 14. סריקה שקופה והכוונה למשתמש
- **תיאור**: מערכת מלווה לסריקות שמסבירה היכן אנו נמצאים ומה ניתן לעשות כדי להאיץ את התהליך.
- **פיצ'רים**:
  - `ScanGuidancePanel` חדש ב־Simple וב־Diamond המציג שלבי סריקה, התקדמות באצוות וטיפים ממוקדים.
  - עדכון ה־hook `useScan` לניהול סטטוסי הנחיה, זיהוי מטמון קיים וחיווי על אצוות שהושלמו.
  - עדכון חלון "סריקת הודעות אחרונות" עם הסבר מדוע הריצה הראשונה איטית ואיך המטמון מאיץ ביקורים חוזרים.
  - טאב התיוגים במשלוח הודעות מציג המלצות, מצב טען מחדש והסבר על התהליך, כולל חלון מענה עשיר עם פס התקדמות.

## ארכיטקטורת קוד ותכנון
- **שכבת תצוגה (React/TypeScript)**  
  - קומפוננט ראשי (`App.tsx`) מנהל מצבי שפה, מודלים וכל הסטייטים הגלובליים.  
  - קומפוננטים ייעודיים למודלים (ScanModal, SettingsModal, UserLookupModal) מופרדים עם העברת אחריות דרך פרופס מבוקרים.  
  - ממשקי סריקה (`SimpleScanInterface`, `DiamondScanInterface`) משתמשים ב־hooks ייעודיים לשיתוף לוגיקה, ומנהלים מבני נתונים מקומיים לסטטיסטיקות ול־SSE.
- **Hooks**  
  - `useAccounts`, `useScan`, `useSemanticSearch`, `useBacklog` אחראיים ללוגיקה אסינכרונית, לניהול מטמונים מקומיים ולשמירה ב־localStorage.  
  - אחריות על חיבור API, טיפול שגיאות והחזרת API מפורמט לקומפוננטה.
- **Backend (FastAPI + Telethon)**  
  - `app/main.py` כנקודת כניסה ושכבת REST.  
  - `app/telegram_delete.py` (לוגיקת טלגרם), `app/checkpoint_manager.py` (Persistency), `app/accounts.py` (ניהול חשבונות) מהווים שכבת שירות.  
  - ניהול משימות רקע וקבצי ענן מאוחסן ב־`cloud_backups/`.
- **Persistence**  
  - נתוני חשבונות ב־`accounts.json`, מצב סריקה ב־localStorage, וגיבויים/לוגים ב־`cloud_backups/`.  
  - מודלים משתמשים ב־`localStorage` לאתחול מצב לאחר ריענון (סריקות, הודעות, שאילתות חיפוש אחרונות).
- **תקשורת בזמן אמת**  
  - SSE (`scan-events`, `semantic-scan-events`) לממשקי סריקה וחיפוש סמנטי.  
  - רישום לוגים בצד הלקוח להצגת פעילות למשתמש (סריקה/בדיקת משתמש).

## פיצ'רים עתידיים מתוכננים

### 1. מעקב זמן שליחה
- שמירת זמן שליחה אחרונה לכל קבוצה
- התראות על שליחה תכופה מדי
- סטטיסטיקות שליחת הודעות

### 2. תבניות הודעות
- תבניות מוכנות להודעות
- משתנים דינמיים (שם קבוצה, תאריך)
- תבניות מותאמות אישית

### 3. סינון קבוצות מתקדם
- סינון לפי גודל קבוצה
- סינון לפי זמן פעילות
- סינון לפי סוג קבוצה

### 4. דוחות וסטטיסטיקות
- דוח סריקות
- סטטיסטיקות שליחת הודעות
- גרפים ויזואליים

## הערות טכניות

### קבצים עיקריים:
- `src/App.tsx` - קומפוננט ראשי
- `src/components/DiamondScanInterface.tsx` - ממשק יהלומים
- `src/components/MessageWizard.tsx` - wizard שליחת הודעות
- `app/main.py` - שרת FastAPI
- `app/telegram_delete.py` - לוגיקת טלגרם
- `app/checkpoint_manager.py` - ניהול checkpoints

### טכנולוגיות:
- React + TypeScript
- Tailwind CSS
- FastAPI + Python
- Telethon (Telegram API)
- localStorage (שמירה מקומית)

### תאריך עדכון אחרון: 2025-10-18
